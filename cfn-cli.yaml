Version: 3

## Level 100 sample: single region, single account, single stage

Blueprints:

  Tools:
    Profile: <profile-name>
    Region: us-east-1
    Tags:
      Environment: Develop

Stages:

  CIBase:
    Order: 1

    PipelineRole:
      Extends: Tools
      Order: 1
      StackName: solder100ci-roles
      Template: ci-base/pipeline-role.template.yaml
      Capabilities: [CAPABILITY_IAM]

    PreReq:
      Extends: Tools
      Order: 3
      StackName: solder100ci-prereq
      Template: ci-base/prereq.template.yaml
      Capabilities: [CAPABILITY_IAM]
      Parameters:
        ProjectIdentifier: solder100
        Account1: "<accound-id>"
        PrimaryRegion: us-east-1
        CodePipelineServiceRole: ${CIBase.PipelineRole.CodePipelineServiceRole}
        CodeBuildServiceRole: ${CIBase.PipelineRole.CodeBuildServiceRole}

  Pipelines:
    Order: 10
    Layers:
      Extends: Tools
      StackName: solder100ci-pipeline-layers
      Template: ci-pipelines/lambda-layer-pipeline.template.yaml
      Capabilities: [CAPABILITY_IAM]
      Parameters:
        PreReqStack: ${CIBase.PreReq.StackName}
        SourcePrefix: source.zip
        Account1: "<account-id>"
        PipelineName: Solder100-SameAccountSameRegionLambdaLayer
        StageNames: Develop
        StackNames: solder100-layers
        LayerNames: Solder100CommonPy37


    TodoApi:
      Extends: Tools
      StackName: solder100ci-pipeline-todoapi
      Template: ci-pipelines/todoapi-pipeline.template.yaml
      Capabilities: [CAPABILITY_IAM]
      Parameters:
        PreReqStack: ${CIBase.PreReq.StackName}
        SourcePrefix: source.zip
        PipelineName: Solder100-SameAccountSameRegionTodoApi
        StageNames: Develop
        Account1: "<account-id>"
        StackNames: solder100-todoapi
        LambdaLayerNames: Solder100CommonPy37
        LambdaLayerVersions: 1
